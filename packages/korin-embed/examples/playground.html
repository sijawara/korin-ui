<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Korin Embed – Playground</title>
    <link rel="stylesheet" href="../dist/embed.css" />
    <style>
      :root {
        /* Light theme (aligned with ai-web globals.css) */
        --bg: #ffffff; /* background */
        --panel: #ffffff; /* card/popover */
        --text: #0a0a0a; /* foreground 0 0% 3.9% */
        --muted: #737373; /* muted-foreground 0 0% 45.1% */
        --accent: #3b82f6; /* ring/sidebar-ring 217 91% 60% */
        --accent-2: #2563eb; /* deeper blue for gradients */
        --border: #e5e5e5; /* border 0 0% 89.8% */
        --shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        --radius: 12px; /* close to 0.5rem */
        --input-bg: #ffffff; /* input/card */
        --input-border: #e5e5e5; /* input/border */
        --hover: #f5f5f5; /* secondary 0 0% 96.1% */
      }
      body.dark {
        /* Dark theme (aligned with ai-web globals.css .dark) */
        --bg: #0a0a0a; /* background 0 0% 3.9% */
        --panel: #0a0a0a; /* card/popover */
        --text: #fafafa; /* foreground 0 0% 98% */
        --muted: #a3a3a3; /* muted-foreground 0 0% 63.9% */
        --accent: #60a5fa; /* chart/ring blue */
        --accent-2: #3b82f6;
        --border: #262626; /* border 0 0% 14.9% */
        --shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
        --input-bg: #111111; /* slightly above background for inputs */
        --input-border: #262626; /* input/border */
        --hover: #1f1f1f; /* close to secondary 0 0% 14.9% */
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family:
          ui-sans-serif,
          system-ui,
          -apple-system,
          Segoe UI,
          Roboto,
          Arial,
          "Noto Sans",
          "Apple Color Emoji",
          "Segoe UI Emoji";
        color: var(--text);
        background:
          radial-gradient(1200px 800px at 10% -10%, rgba(34, 211, 238, 0.12), transparent),
          radial-gradient(900px 600px at 110% 10%, rgba(96, 165, 250, 0.1), transparent), var(--bg);
        min-height: 100vh;
      }
      a {
        color: var(--accent);
      }

      /* Layout */
      .shell {
        display: grid;
        grid-template-columns: 1fr;
        min-height: 100vh;
      }

      .topbar {
        position: sticky;
        top: 0;
        z-index: 30;
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        justify-content: space-between;
        gap: 12px;
        padding: 16px clamp(16px, 4vw, 28px);
        border-bottom: 1px solid var(--border);
        background: linear-gradient(180deg, rgba(2, 6, 23, 0.75), rgba(2, 6, 23, 0.55));
        backdrop-filter: blur(8px);
      }
      .brand {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .logo {
        width: 28px;
        height: 28px;
        border-radius: 8px;
        background: #ffffff;
        box-shadow:
          inset 0 0 0 2px rgba(255, 255, 255, 0.25),
          var(--shadow);
      }
      .brand h1 {
        font-size: 16px;
        margin: 0;
        letter-spacing: 0.2px;
      }
      .controls {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 10px;
      }
      .controls .theme-toggle {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 10px;
        border-radius: 10px;
        border: 1px solid var(--border);
        background: #0b142910;
        color: var(--text);
        cursor: pointer;
      }
      .select,
      .button,
      .input {
        border: 1px solid var(--input-border);
        background: var(--input-bg);
        color: var(--text);
        padding: 10px 12px;
        border-radius: 8px;
        font-size: 14px;
        transition: all 0.2s ease;
      }
      .input:focus,
      .select:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 3px rgba(8, 145, 178, 0.1);
      }
      .button.primary {
        background: linear-gradient(135deg, var(--accent), var(--accent-2));
        color: white;
        border: none;
        font-weight: 600;
        box-shadow: var(--shadow);
      }
      .button.primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 8px 25px rgba(8, 145, 178, 0.3);
      }
      .button.ghost {
        background: var(--hover);
        border: 1px solid var(--border);
      }
      .button.ghost:hover {
        background: var(--input-bg);
      }
      .button {
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .content {
        display: grid;
        grid-template-columns: 1fr;
        gap: 16px;
        padding: 18px clamp(16px, 4vw, 28px) 32px;
      }

      /* Hero section */
      .hero {
        display: grid;
        gap: 12px;
        padding: 12px 0 4px;
      }
      .hero h1 {
        font-size: clamp(22px, 4vw, 32px);
        line-height: 1.2;
        margin: 0;
      }
      .hero p {
        margin: 0;
        color: var(--muted);
        max-width: 65ch;
      }
      .cta {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 6px;
      }
      .cta .button {
        padding: 10px 14px;
      }

      .canvas {
        border: 1px solid var(--border);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.01));
        padding: 18px;
        min-height: min(72vh, 760px);
        position: relative;
      }
      .canvas h2 {
        margin: 6px 0 12px;
        font-size: 18px;
        font-weight: 600;
        color: #cbd5e1;
      }
      /* Canvas tabs */
      .canvas-tabs {
        display: flex;
        gap: 8px;
        margin-bottom: 10px;
      }
      .canvas-tabs .ctab {
        border: 1px solid var(--border);
        padding: 6px 12px;
        border-radius: 9999px;
        font-size: 13px;
        font-weight: 500;
        background: var(--input-bg);
        color: var(--muted);
        cursor: pointer;
        transition: all 0.2s ease;
      }
      .canvas-tabs .ctab:hover {
        background: var(--hover);
        color: var(--text);
      }
      .canvas-tabs .ctab.active {
        background: var(--accent);
        color: white;
        border-color: var(--accent);
      }
      .canvas-tabs .gear {
        margin-left: auto;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 32px;
        height: 32px;
        padding: 0;
      }
      .canvas-panel.hidden {
        display: none;
      }
      .codebox {
        border: 1px solid var(--border);
        background: var(--hover);
        border-radius: 8px;
        padding: 12px;
        overflow: auto;
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
        font-size: 12px;
        line-height: 1.4;
        max-height: 420px;
      }
      .code-actions {
        display: flex;
        justify-content: flex-end;
        gap: 8px;
        margin-bottom: 8px;
      }
      .hint {
        color: var(--muted);
        font-size: 13px;
      }

      /* Config panel */
      .config-panel {
        position: fixed;
        right: 16px;
        top: 82px;
        width: min(480px, calc(100vw - 32px));
        max-height: calc(100vh - 100px);
        overflow-y: hidden;
        overflow-x: hidden;
        border: 1px solid var(--border);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        background: var(--panel);
        transform: translateX(0);
        transition: transform 300ms cubic-bezier(0.2, 0.8, 0.2, 1);
        z-index: 40;
      }
      .config-panel.hidden {
        transform: translateX(calc(100% + 16px));
      }
      .config-header {
        position: sticky;
        top: 0;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
        padding: 16px 20px;
        border-bottom: 1px solid var(--border);
        background: var(--panel);
        backdrop-filter: blur(8px);
        border-top-left-radius: var(--radius);
        border-top-right-radius: var(--radius);
      }
      .config-body {
        padding: 0;
        overflow-y: auto;
        overflow-x: hidden;
        max-height: calc(100vh - 180px);
      }
      .tabbar {
        display: flex;
        flex-wrap: wrap;
        gap: 4px;
        padding: 16px 20px 12px;
        position: sticky;
        top: 0;
        background: var(--panel);
        z-index: 1;
        border-bottom: 1px solid var(--border);
      }
      .tabbar .tab {
        border: 1px solid var(--border);
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 13px;
        font-weight: 500;
        background: var(--input-bg);
        color: var(--muted);
        cursor: pointer;
        transition: all 0.2s ease;
      }
      .tabbar .tab:hover {
        background: var(--hover);
        color: var(--text);
      }
      .tabbar .tab.active {
        background: var(--accent);
        color: white;
        border-color: var(--accent);
      }
      .section.hidden {
        display: none;
      }
      .section {
        padding: 20px;
      }
      .fieldset {
        border: none;
        background: var(--hover);
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 16px;
      }
      .legend {
        font-size: 14px;
        font-weight: 600;
        color: var(--text);
        margin-bottom: 16px;
        display: block;
      }
      .legend.subtle {
        font-size: 12px;
        font-weight: 500;
        color: var(--muted);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin: 24px 0 12px 0;
      }
      .grid-2 {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }
      .grid-3 {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 12px;
      }
      .row {
        display: grid;
        grid-template-columns: 1fr;
        gap: 12px;
        align-items: start;
        margin-bottom: 12px;
      }
      .row label {
        font-size: 13px;
        font-weight: 500;
        color: var(--text);
        line-height: 1.2;
        word-break: break-word;
        grid-column: 1 / -1;
        margin-bottom: -4px;
      }
      .row input[type="checkbox"] {
        width: 18px;
        height: 18px;
        accent-color: var(--accent);
      }
      /* Checkbox rows: first line = [checkbox][title], second line = description under title */
      .row.checkbox {
        grid-template-columns: auto 1fr;
        row-gap: 2px;
      }
      .row.checkbox input[type="checkbox"] {
        grid-column: 1;
        grid-row: 1;
        align-self: center;
        justify-self: start;
      }
      .row.checkbox label {
        grid-column: 2;
        grid-row: 1;
        margin: 0;
      }
      .row.checkbox .desc {
        grid-column: 2;
        grid-row: 2;
        margin-top: 2px;
      }
      .row .input,
      .row .select,
      .row input[type="checkbox"],
      .row select {
        grid-column: 1 / -1;
      }
      .row .input,
      .row .select {
        width: 100%;
        max-width: 100%;
      }
      .desc {
        grid-column: 1 / -1;
        font-size: 12px;
        color: var(--muted);
        margin-top: -6px;
      }
      .subtle {
        color: var(--muted);
        font-size: 12px;
        background: var(--hover);
        padding: 12px;
        border-radius: 6px;
        border-left: 3px solid var(--accent);
      }

      /* Accessibility helpers */
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }
      :focus-visible {
        outline: 3px solid var(--accent-2);
        outline-offset: 2px;
      }

      .floating-controls {
        position: absolute;
        top: 14px;
        right: 14px;
        display: flex;
        gap: 8px;
      }

      @media (max-width: 860px) {
        .row {
          grid-template-columns: 1fr;
        }
        .grid-2,
        .grid-3 {
          grid-template-columns: 1fr;
        }
        .config-panel {
          right: 12px;
          top: 74px;
        }
      }
    </style>
  </head>
  <body>
    <div class="shell">
      <!-- Header (semantic) -->
      <header class="topbar" role="banner">
        <div class="brand">
          <img class="logo" src="https://korin.ai/logo/KorinAILogo-Black.svg" alt="Korin Logo" />
          <h1 style="margin: 0">Korin Embed Playground</h1>
        </div>
        <div class="controls">
          <button
            id="mode-toggle"
            class="button ghost"
            aria-pressed="false"
            aria-label="Switch between Page and Floating modes"
          >
            Variant: Page
          </button>
          <button id="toggle-theme" class="theme-toggle" title="Toggle Theme" aria-label="Toggle theme">🌙/☀️</button>
          <button
            id="toggle-float"
            class="button primary"
            title="Toggle Floating Window"
            aria-label="Toggle floating chat window"
          >
            Toggle Floating
          </button>
        </div>
      </header>

      <!-- Main content (semantic) -->
      <main class="content" role="main">
        <!-- Hero section -->
        <section class="hero" aria-labelledby="hero-title">
          <h2 id="hero-title" class="sr-only">Overview</h2>
        </section>

        <div class="canvas">
          <div class="canvas-tabs" role="tablist" aria-label="Canvas tabs">
            <button
              id="ctab-component"
              class="ctab active"
              role="tab"
              aria-selected="true"
              aria-controls="canvas-component"
              data-tab="component"
            >
              Component
            </button>
            <button
              id="ctab-embed"
              class="ctab"
              role="tab"
              aria-selected="false"
              aria-controls="canvas-embed"
              data-tab="embed"
            >
              Embed code
            </button>
            <button
              id="ctab-docs"
              class="ctab"
              role="tab"
              aria-selected="false"
              aria-controls="canvas-docs"
              data-tab="docs"
            >
              Docs
            </button>
            <button
              id="gear-config"
              class="button ghost gear"
              title="Toggle Configurator"
              aria-label="Toggle configurator panel"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="lucide lucide-cog"
              >
                <path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Z" />
                <path
                  d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33h0A1.65 1.65 0 0 0 9.91 3.1V3a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51h0a1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82v0A1.65 1.65 0 0 0 21 11h.09a2 2 0 1 1 0 4H21a1.65 1.65 0 0 0-1.51 1Z"
                />
              </svg>
            </button>
          </div>

          <section
            id="canvas-component"
            class="canvas-panel"
            role="tabpanel"
            aria-labelledby="ctab-component"
            aria-hidden="false"
          >
            <div
              id="page-host"
              style="min-height: 520px; border: 1px dashed #1c2846; border-radius: 10px; padding: 12px; display: block"
            ></div>
            <div id="floating-host" style="position: fixed; bottom: 24px; right: 24px"></div>
          </section>

          <section
            id="canvas-embed"
            class="canvas-panel hidden"
            role="tabpanel"
            aria-labelledby="ctab-embed"
            aria-hidden="true"
          >
            <div class="row">
              <label>Copy-pasteable embed code</label>
              <div class="desc">
                This snippet reflects your current settings. Adjust the script src path to match your environment.
              </div>
              <div class="code-actions">
                <button id="copy-embed" class="button ghost">Copy</button>
              </div>
              <pre class="codebox"><code id="embed-code"></code></pre>
            </div>
          </section>

          <section
            id="canvas-docs"
            class="canvas-panel hidden"
            role="tabpanel"
            aria-labelledby="ctab-docs"
            aria-hidden="true"
          >
            <div class="row">
              <label>Documentation</label>
              <div class="desc">Open the latest Quick Start guide in a new tab.</div>
              <div>
                <a
                  class="button ghost"
                  target="_blank"
                  rel="noopener"
                  href="https://korinai.com/documentation/getting-started/quick-start"
                  >Open Docs</a
                >
              </div>
            </div>
          </section>
        </div>
        <div class="hint">
          Only one demo is active at a time. Switching modes will hide the other and reset visibility appropriately.
        </div>
      </main>
    </div>

    <!-- Configurator Panel -->
    <aside id="config" class="config-panel hidden">
      <div class="config-header">
        <strong>Configurator</strong>
        <button id="close-config" class="button ghost close">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-x-icon lucide-x"
          >
            <path d="M18 6 6 18" />
            <path d="m6 6 12 12" />
          </svg>
        </button>
      </div>
      <div class="config-body">
        <p class="subtle" style="margin: 0 2px 8px">
          Note: This configurator is not complete yet. Some properties are not configurable in this demo.
        </p>
        <div class="tabbar" role="tablist" aria-label="Configurator tabs">
          <button
            id="tab-provider"
            class="tab active"
            role="tab"
            aria-selected="true"
            aria-controls="panel-provider"
            data-tab="provider"
          >
            Provider
          </button>
          <button
            id="tab-floating"
            class="tab"
            role="tab"
            aria-selected="false"
            aria-controls="panel-floating"
            data-tab="floating"
          >
            Floating
          </button>
          <button id="tab-page" class="tab" role="tab" aria-selected="false" aria-controls="panel-chat" data-tab="chat">
            Chat
          </button>
          <button
            id="tab-requests"
            class="tab"
            role="tab"
            aria-selected="false"
            aria-controls="panel-requests"
            data-tab="requests"
          >
            Requests
          </button>
          <button
            id="tab-branding"
            class="tab"
            role="tab"
            aria-selected="false"
            aria-controls="panel-branding"
            data-tab="branding"
          >
            Branding
          </button>
        </div>

        <div
          id="panel-provider"
          class="fieldset section"
          data-section="provider"
          role="tabpanel"
          aria-labelledby="tab-provider"
          aria-hidden="false"
        >
          <div class="legend">Embed Provider</div>
          <p class="desc">
            Configure the base connection for Korin Embed. These settings apply to both Page and Floating chat.
          </p>
          <div class="row">
            <label for="prov-base">Base URL</label>
            <div class="desc">Root URL of your host app serving static assets and pages.</div>
            <input id="prov-base" class="input" type="text" value="https://api.korinai.com" />
          </div>
          <div class="row">
            <label for="prov-chatapi">Chat API endpoint</label>
            <div class="desc">HTTP endpoint used by the chat component to send and receive messages.</div>
            <input id="prov-chatapi" class="input" type="text" value="https://api.korinai.com/api/chat" />
          </div>
          <div class="row">
            <label for="prov-credits">Minimum credits warning</label>
            <div class="desc">Show a warning if credits drop below this value.</div>
            <input id="prov-credits" class="input" type="text" value="10" />
          </div>
          <div class="row">
            <label for="prov-token">Auth token</label>
            <div class="desc">Bearer token used to authenticate requests to your API.</div>
            <input id="prov-token" class="input" type="text" value="" />
          </div>
          <div class="row">
            <label for="prov-lang">Language</label>
            <div class="desc">Two-letter language code (e.g. en, id) for UI labels.</div>
            <input id="prov-lang" class="input" type="text" value="en" />
          </div>
          <div class="row checkbox">
            <label for="prov-ensure">Ensure styles</label>
            <div class="desc">Inject core styles automatically if your site does not include them.</div>
            <input id="prov-ensure" type="checkbox" checked />
          </div>
        </div>
        <div
          id="panel-chat"
          class="fieldset section hidden"
          data-section="chat"
          role="tabpanel"
          aria-labelledby="tab-page"
          aria-hidden="true"
        >
          <div class="legend">Chat Settings</div>
          <p class="desc">Unified options applied to both Page and Floating chat.</p>
          <div class="row">
            <label for="cfg-title">Title</label>
            <div class="desc">Displayed at the top of the chat UI.</div>
            <input id="cfg-title" class="input" type="text" value="Chat with KorinAI" />
          </div>
          <div class="row">
            <label for="cfg-variant">Variant</label>
            <div class="desc">Choose between a flat layout or a card-styled chat UI.</div>
            <select id="cfg-variant" class="select">
              <option value="flat" selected>flat</option>
              <option value="card">card</option>
            </select>
          </div>
          <div class="row checkbox">
            <label for="pc-show-close">Show Close button</label>
            <div class="desc">Display a close button on the page chat header.</div>
            <input id="pc-show-close" type="checkbox" />
          </div>
          <div class="row checkbox">
            <label for="pc-show-room">Show room name</label>
            <div class="desc">Display the current room name in the header.</div>
            <input id="pc-show-room" type="checkbox" />
          </div>
          <div class="row checkbox">
            <label for="cfg-hide-history">Hide history</label>
            <div class="desc">Hide previous messages when opening the chat.</div>
            <input id="cfg-hide-history" type="checkbox" />
          </div>
          <div class="row">
            <label for="pc-default-room">Default room ID</label>
            <div class="desc">Set an initial room to load when the chat mounts.</div>
            <input id="pc-default-room" class="input" type="text" placeholder="room-id" />
          </div>
          <div class="row">
            <label for="cfg-page-size">Page size</label>
            <div class="desc">Number of messages to fetch per page.</div>
            <input id="cfg-page-size" class="input" type="number" min="5" max="50" value="10" />
          </div>
          <div class="row">
            <label for="cfg-header-slot">Header right slot</label>
            <div class="desc">Optional text or indicator to display on the right of the header.</div>
            <input id="cfg-header-slot" class="input" type="text" placeholder="e.g. Beta" />
          </div>
          <div class="row">
            <label for="cfg-throttle">Throttle (ms)</label>
            <div class="desc">Debounce time for user input to reduce API calls.</div>
            <input id="cfg-throttle" class="input" type="number" min="0" max="1000" value="100" />
          </div>
          <div class="legend subtle">UI Controls</div>
          <div class="row checkbox">
            <label for="cfg-ui-stop">Show Stop button</label>
            <div class="desc">Allow users to stop a generation mid-way.</div>
            <input id="cfg-ui-stop" type="checkbox" checked />
          </div>
          <div class="row checkbox">
            <label for="cfg-ui-attach">Show Attach button</label>
            <div class="desc">Allow users to attach files to messages.</div>
            <input id="cfg-ui-attach" type="checkbox" checked />
          </div>
          <div class="row checkbox">
            <label for="cfg-ui-actions">Show Actions menu</label>
            <div class="desc">Show extra quick actions in the composer.</div>
            <input id="cfg-ui-actions" type="checkbox" checked />
          </div>
          <div class="row checkbox">
            <label for="cfg-ui-agent">Show agent selector</label>
            <div class="desc">Let users pick a default agent/persona.</div>
            <input id="cfg-ui-agent" type="checkbox" />
          </div>
          <div class="row">
            <label for="cfg-default-agent">Default agent username</label>
            <div class="desc">Username of the agent to select by default.</div>
            <input id="cfg-default-agent" class="input" type="text" placeholder="agent_username" />
          </div>
        </div>

        <div
          id="panel-floating"
          class="fieldset section hidden"
          data-section="floating"
          role="tabpanel"
          aria-labelledby="tab-floating"
          aria-hidden="true"
        >
          <div class="legend">Floating Chat (optional)</div>
          <p class="desc">Settings specific to the floating launcher and window.</p>
          <div class="row checkbox">
            <label for="fc-show">Show floating button</label>
            <div class="desc">Show or hide the launcher button on the page.</div>
            <input id="fc-show" type="checkbox" checked />
          </div>
          <div class="row">
            <label for="fc-trigger">Trigger icon size</label>
            <div class="desc">Size of the floating launcher icon (in pixels).</div>
            <input id="fc-trigger" class="input" type="number" min="16" max="64" value="28" />
          </div>
          <div class="row">
            <label for="fc-btn-class">Button CSS classes</label>
            <div class="desc">Optional Tailwind or CSS classes to style the launcher button.</div>
            <input id="fc-btn-class" class="input" type="text" placeholder="e.g. bg-emerald-600" />
          </div>
          <div class="row">
            <label for="fc-win-class">Chat window CSS classes</label>
            <div class="desc">Optional classes to control the floating chat window size and layout.</div>
            <input id="fc-win-class" class="input" type="text" placeholder="e.g. sm:w-[520px] sm:h-[680px]" />
          </div>
          <div class="row checkbox">
            <label for="fc-ctrl-open">Controlled open</label>
            <div class="desc">When enabled, opening is controlled programmatically via callbacks.</div>
            <input id="fc-ctrl-open" type="checkbox" />
          </div>
          <div class="row checkbox">
            <label for="fc-def-open">Open by default</label>
            <div class="desc">Start with the floating chat window open on page load.</div>
            <input id="fc-def-open" type="checkbox" />
          </div>
        </div>

        <div
          id="panel-requests"
          class="fieldset section hidden"
          data-section="requests"
          role="tabpanel"
          aria-labelledby="tab-requests"
          aria-hidden="true"
        >
          <div class="legend">Request Configuration</div>
          <p class="desc">Optional headers and body fields that will be sent with chat requests.</p>
          <div class="row">
            <label for="pc-headers">Request headers (JSON)</label>
            <div class="desc">JSON object of headers to merge into each request.</div>
            <input id="pc-headers" class="input" type="text" placeholder='{"X-Debug":"1"}' />
          </div>
          <div class="legend subtle">Request body fields</div>
          <div class="grid-2">
            <div class="row">
              <label for="pb-requester-id">requesterId</label>
              <div class="desc">Unique ID of the user initiating the request.</div>
              <input id="pb-requester-id" class="input" type="text" />
            </div>
            <div class="row">
              <label for="pb-requester-email">requesterEmail</label>
              <div class="desc">Email of the requester.</div>
              <input id="pb-requester-email" class="input" type="email" />
            </div>
          </div>
          <div class="grid-2">
            <div class="row">
              <label for="pb-participant-id">participantId</label>
              <div class="desc">User ID of the other participant.</div>
              <input id="pb-participant-id" class="input" type="text" />
            </div>
            <div class="row">
              <label for="pb-participant-email">participantEmail</label>
              <div class="desc">Email of the other participant.</div>
              <input id="pb-participant-email" class="input" type="email" />
            </div>
          </div>
          <div class="grid-2">
            <div class="row">
              <label for="pb-room-id">roomId</label>
              <div class="desc">Room or conversation identifier.</div>
              <input id="pb-room-id" class="input" type="text" />
            </div>
            <div class="row">
              <label for="pb-gallery-id">gallery_id</label>
              <div class="desc">Optional gallery identifier for shared assets.</div>
              <input id="pb-gallery-id" class="input" type="text" />
            </div>
          </div>
          <div class="grid-2">
            <div class="row">
              <label for="pb-file-url">file_url</label>
              <div class="desc">URL of a file to include with the request.</div>
              <input id="pb-file-url" class="input" type="url" />
            </div>
            <div class="row">
              <label for="pb-file-caption">file_caption</label>
              <div class="desc">Short caption for the attached file.</div>
              <input id="pb-file-caption" class="input" type="text" />
            </div>
          </div>
          <div class="grid-2">
            <div class="row">
              <label for="pb-extra">extra_context</label>
              <div class="desc">Additional JSON or text context.</div>
              <input id="pb-extra" class="input" type="text" />
            </div>
            <div class="row">
              <label for="pb-message-id">messageId</label>
              <div class="desc">Reference message ID related to this request.</div>
              <input id="pb-message-id" class="input" type="text" />
            </div>
          </div>
          <div class="row">
            <label for="pb-secrets">secrets (JSON)</label>
            <div class="desc">Array of secret key-value pairs used for secure operations.</div>
            <input id="pb-secrets" class="input" type="text" placeholder='[{"key":"k","value":"v"}]' />
          </div>
        </div>

        <div
          id="panel-branding"
          class="fieldset section hidden"
          data-section="branding"
          role="tabpanel"
          aria-labelledby="tab-branding"
          aria-hidden="true"
        >
          <div class="legend">Branding Configuration</div>
          <div class="row checkbox">
            <label for="pc-brand-show">showHeaderLogo</label>
            <div class="desc">Display your brand logo in the chat header.</div>
            <input id="pc-brand-show" type="checkbox" checked />
          </div>
          <div class="row">
            <label for="pc-logo-light">logoLightUrl</label>
            <div class="desc">Logo shown when using the light theme.</div>
            <input id="pc-logo-light" class="input" type="text" placeholder="https://.../logo-light.svg" />
          </div>
          <div class="row">
            <label for="pc-logo-dark">logoDarkUrl</label>
            <div class="desc">Logo shown when using the dark theme.</div>
            <input id="pc-logo-dark" class="input" type="text" placeholder="https://.../logo-dark.svg" />
          </div>
          <div class="legend subtle">Logo Sizes</div>
          <div class="grid-2">
            <div class="row">
              <label for="pc-logo-w">logoSize.width</label>
              <div class="desc">Width of the main logo (pixels).</div>
              <input id="pc-logo-w" class="input" type="number" min="12" max="300" value="50" />
            </div>
            <div class="row">
              <label for="pc-logo-h">logoSize.height</label>
              <div class="desc">Height of the main logo (pixels).</div>
              <input id="pc-logo-h" class="input" type="number" min="12" max="300" value="50" />
            </div>
          </div>
          <div class="grid-2">
            <div class="row">
              <label for="pc-hlogo-w">headerLogoSize.width</label>
              <div class="desc">Width of the header logo (pixels).</div>
              <input id="pc-hlogo-w" class="input" type="number" min="12" max="300" value="28" />
            </div>
            <div class="row">
              <label for="pc-hlogo-h">headerLogoSize.height</label>
              <div class="desc">Height of the header logo (pixels).</div>
              <input id="pc-hlogo-h" class="input" type="number" min="12" max="300" value="28" />
            </div>
          </div>
        </div>
      </div>
    </aside>

    <!-- IIFE bundle -->
    <script src="../dist/embed.js"></script>
    <script>
      (function () {
        // Mode toggle button replaces the old <select>
        const elMode = document.getElementById("mode"); // legacy, may be null
        const elModeToggle = document.getElementById("mode-toggle");
        const elToggleConfig = document.getElementById("toggle-config");
        const elToggleTheme = document.getElementById("toggle-theme");
        const elToggleFloat = document.getElementById("toggle-float");
        const panel = document.getElementById("config");
        const closeConfig = document.getElementById("close-config");
        const pageHost = document.getElementById("page-host");
        const floatingHost = document.getElementById("floating-host");
        const canvasTitle = document.getElementById("canvas-title");
        let currentMode = "page"; // 'page' | 'floating'

        function updateFloatingToggleVisibility() {
          if (!elToggleFloat) return;
          const show = currentMode === "floating";
          elToggleFloat.style.display = show ? "" : "none";
          elToggleFloat.setAttribute("aria-hidden", show ? "false" : "true");
        }

        function setMode(mode) {
          currentMode = mode;
          if (elModeToggle) {
            const isFloating = mode === "floating";
            elModeToggle.textContent = `Variant: ${isFloating ? "Floating" : "Page"}`;
            elModeToggle.setAttribute("aria-pressed", String(isFloating));
          }
          if (mode === "floating") {
            mountFloating();
          } else {
            mountPage();
          }
          updateFloatingToggleVisibility();
          // Refresh embed code view when switching modes
          try {
            updateEmbedCode();
          } catch (e) {}
        }

        const $ = (id) => {
          const el = document.getElementById(id);
          if (!el) {
            console.warn(`Element with id "${id}" not found`);
            return { value: "", checked: false, textContent: "" };
          }
          return el;
        };

        const getValue = (id, defaultValue = "") => {
          const el = $(id);
          return el.value || defaultValue;
        };

        const getChecked = (id, defaultValue = false) => {
          const el = $(id);
          return el.checked !== undefined ? el.checked : defaultValue;
        };

        const getNumber = (id, defaultValue = 0) => {
          const val = getValue(id);
          const num = Number(val);
          return isNaN(num) ? defaultValue : num;
        };

        const parseJson = (val) => {
          try {
            return val && val.trim() ? JSON.parse(val) : undefined;
          } catch (e) {
            console.warn("Invalid JSON:", val, e);
            return undefined;
          }
        };

        function providerOpts() {
          return {
            baseUrl: getValue("prov-base", "https://3000.refind.id"),
            chatApi: getValue("prov-chatapi", "https://3000.refind.id/api/chat"),
            minimumCreditsWarning: getValue("prov-credits", "10"),
            authToken: getValue("prov-token"),
            language: getValue("prov-lang", "en"),
          };
        }

        function floatingProps() {
          const controlled = getChecked("fc-ctrl-open");
          const branding = {
            logoLightUrl: getValue("pc-logo-light") || undefined,
            logoDarkUrl: getValue("pc-logo-dark") || undefined,
            logoSize: {
              width: getNumber("pc-logo-w", 50),
              height: getNumber("pc-logo-h", 50),
            },
            headerLogoSize: {
              width: getNumber("pc-hlogo-w", 28),
              height: getNumber("pc-hlogo-h", 28),
            },
            showHeaderLogo: getChecked("pc-brand-show", true),
          };

          const pagePropsData = pageProps();

          return {
            title: getValue("cfg-title") || getValue("fc-title", "Chat with KorinAI"),
            triggerIconSize: getNumber("fc-trigger", 28),
            showFloatingButton: getChecked("fc-show", true),
            buttonClassName: getValue("fc-btn-class") || undefined,
            chatWindowClassName: getValue("fc-win-class") || undefined,
            open: controlled ? true : undefined,
            onOpenChange: controlled ? (o) => console.log("open changed", o) : undefined,
            defaultOpen: getChecked("fc-def-open"),
            branding,
            chatProps: {
              ...pagePropsData,
              variant: getValue("cfg-variant") || getValue("fc-chat-variant", "flat"),
              hideHistory: getChecked("cfg-hide-history") || getChecked("fc-hide-history"),
              pageSize: getNumber("cfg-page-size", getNumber("fc-page-size", 10)),
              headerRightSlot: getValue("cfg-header-slot") || getValue("fc-header-slot") || undefined,
              ui: {
                ...(pagePropsData.ui || {}),
                showStop: getChecked("cfg-ui-stop", getChecked("fc-ui-stop", true)),
                showAttach: getChecked("cfg-ui-attach", getChecked("fc-ui-attach", true)),
                showActions: getChecked("cfg-ui-actions", getChecked("fc-ui-actions", true)),
                showAgentSelector: getChecked("cfg-ui-agent", getChecked("fc-ui-agent")),
                defaultAgentUsername: getValue("cfg-default-agent") || getValue("fc-default-agent") || undefined,
              },
            },
          };
        }

        function pageProps() {
          const rb = {
            requesterId: getValue("pb-requester-id") || undefined,
            requesterEmail: getValue("pb-requester-email") || undefined,
            participantId: getValue("pb-participant-id") || undefined,
            participantEmail: getValue("pb-participant-email") || undefined,
            roomId: getValue("pb-room-id") || undefined,
            gallery_id: getValue("pb-gallery-id") || undefined,
            file_url: getValue("pb-file-url") || undefined,
            file_caption: getValue("pb-file-caption") || undefined,
            extra_context: getValue("pb-extra") || undefined,
            messageId: getValue("pb-message-id") || undefined,
            secrets: parseJson(getValue("pb-secrets")),
          };
          Object.keys(rb).forEach((k) => rb[k] === undefined && delete rb[k]);

          return {
            title: getValue("cfg-title") || getValue("pc-title", "Chat with KorinAI"),
            variant: getValue("cfg-variant") || getValue("pc-variant", "flat"),
            showCloseButton: getChecked("pc-show-close"),
            defaultRoomId: getValue("pc-default-room") || undefined,
            showRoomName: getChecked("pc-show-room"),
            pageSize: getNumber("cfg-page-size", getNumber("pc-page-size", 10)),
            hideHistory: getChecked("cfg-hide-history") || getChecked("pc-hide"),
            headerRightSlot: getValue("cfg-header-slot") || getValue("pc-slot") || undefined,
            ui: {
              showStop: getChecked("cfg-ui-stop", getChecked("pc-ui-stop", true)),
              showAttach: getChecked("cfg-ui-attach", getChecked("pc-ui-attach", true)),
              showActions: getChecked("cfg-ui-actions", getChecked("pc-ui-actions", true)),
              showAgentSelector: getChecked("cfg-ui-agent", getChecked("pc-ui-agent", true)),
              defaultAgentUsername: getValue("cfg-default-agent") || getValue("pc-ui-default-agent") || undefined,
            },
            branding: {
              showHeaderLogo: getChecked("pc-brand-show", true),
              logoLightUrl: getValue("pc-logo-light") || undefined,
              logoDarkUrl: getValue("pc-logo-dark") || undefined,
              logoSize: {
                width: getNumber("pc-logo-w", 50),
                height: getNumber("pc-logo-h", 50),
              },
              headerLogoSize: {
                width: getNumber("pc-hlogo-w", 28),
                height: getNumber("pc-hlogo-h", 28),
              },
            },
            throttleMs: getNumber("cfg-throttle", getNumber("pc-throttle", 100)),
            requestHeaders: parseJson(getValue("pc-headers")),
            requestBody: Object.keys(rb).length > 0 ? rb : undefined,
            onRoomChange: getChecked("pc-on-room") ? (rid) => console.log("room change", rid) : undefined,
            onSend: undefined,
          };
        }

        function ensureAPI() {
          if (!window.KorinAI || typeof window.KorinAI.init !== "function") {
            console.error("[KorinAI] global object not found. Did you build and include ../dist/embed.js?");
            return false;
          }
          return true;
        }

        function mountFloating() {
          if (!ensureAPI()) return;
          try {
            pageHost.style.display = "none";
            floatingHost.style.display = "block";

            window.KorinAI.init({
              target: "#floating-host",
              ensureStyles: getChecked("prov-ensure", true),
              variant: "floating",
              ...providerOpts(),
              props: floatingProps(),
            });
          } catch (error) {
            console.error("Error mounting floating chat:", error);
          }
        }

        function mountPage() {
          if (!ensureAPI()) return;
          try {
            floatingHost.style.display = "none";
            pageHost.style.display = "block";

            // Make sure floating chat is hidden if previously active
            try {
              window.KorinAI.toggleFloatingChat(false);
            } catch (e) {}
            try {
              window.KorinAI.floating && window.KorinAI.floating.reload({ props: { showFloatingButton: false } });
            } catch (e) {}

            window.KorinAI.init({
              target: "#page-host",
              ensureStyles: false,
              variant: "page",
              ...providerOpts(),
              props: pageProps(),
            });
          } catch (error) {
            console.error("Error mounting page chat:", error);
          }
        }

        function reloadActive() {
          try {
            const mode = currentMode || "page";
            if (mode === "floating") {
              if (window.KorinAI?.floating?.reload) {
                window.KorinAI.floating.reload({ props: floatingProps() });
              } else {
                mountFloating();
              }
            } else {
              if (window.KorinAI?.page?.reload) {
                window.KorinAI.page.reload({ props: pageProps() });
              } else {
                mountPage();
              }
            }
          } catch (error) {
            console.error("Error reloading active chat:", error);
          }
        }

        // --- Canvas tabs + Embed code generation ---
        function buildEmbedPayload() {
          const mode = currentMode || "page";
          const provider = providerOpts();
          const props = mode === "floating" ? floatingProps() : pageProps();

          const payload = {
            target: "#my-chat",
            ensureStyles: getChecked("prov-ensure", true),
            variant: mode === "floating" ? "floating" : "page",
            ...provider,
            props,
          };
          // Remove functions/undefined for clean embed output
          const sanitized = JSON.parse(JSON.stringify(payload, (k, v) => (typeof v === "function" ? undefined : v)));
          return sanitized;
        }

        function generateEmbedString() {
          const payload = buildEmbedPayload();
          const payloadStr = JSON.stringify(payload, null, 2);
          // Use <\/script> to avoid closing the current script tag in HTML parsing
          const code = `<!-- Include Korin Embed assets -->\n<link rel=\"stylesheet\" href=\"../dist/embed.css\" />\n<div id=\"my-chat\"></div>\n<script src=\"../dist/embed.js\"><\/script>\n<script>\n  window.KorinAI.init(${payloadStr});\n<\/script>`;
          return code;
        }

        function updateEmbedCode() {
          const codeEl = document.getElementById("embed-code");
          if (!codeEl) return;
          try {
            codeEl.textContent = generateEmbedString();
          } catch (e) {
            codeEl.textContent = "<!-- Failed to generate embed code -->";
          }
        }

        // Wire up UI with error handling
        if (elModeToggle) {
          elModeToggle.addEventListener("click", () => {
            try {
              setMode(currentMode === "page" ? "floating" : "page");
            } catch (error) {
              console.error("Error toggling mode:", error);
            }
          });
        }

        if (elToggleConfig && panel) {
          elToggleConfig.addEventListener("click", () => panel.classList.toggle("hidden"));
        }

        if (closeConfig && panel) {
          closeConfig.addEventListener("click", () => panel.classList.add("hidden"));
        }

        if (elToggleTheme) {
          elToggleTheme.addEventListener("click", () => {
            document.body.classList.toggle("dark");
            // Update theme button text
            elToggleTheme.textContent = document.body.classList.contains("dark") ? "☀️" : "🌙";
          });
        }

        // Hero CTA -> open configurator
        const ctaOpenConfig = document.getElementById("cta-open-config");
        if (ctaOpenConfig && panel) {
          ctaOpenConfig.addEventListener("click", () => {
            panel.classList.remove("hidden");
            // Focus the first tab for accessibility
            document.getElementById("tab-provider")?.focus();
          });
        }

        // Tabs with accessibility and keyboard support
        const tabs = Array.from(document.querySelectorAll(".tabbar .tab"));
        const panels = Array.from(document.querySelectorAll(".section"));
        const activateTab = (btn) => {
          try {
            const tab = btn.getAttribute("data-tab");
            // Update tab buttons
            tabs.forEach((b) => {
              const isActive = b === btn;
              b.classList.toggle("active", isActive);
              b.setAttribute("aria-selected", isActive ? "true" : "false");
              b.tabIndex = isActive ? 0 : -1;
            });
            // Update panels
            panels.forEach((sec) => {
              const s = sec.getAttribute("data-section");
              const show = s === tab;
              sec.classList.toggle("hidden", !show);
              sec.setAttribute("aria-hidden", show ? "false" : "true");
            });
          } catch (error) {
            console.error("Error switching tabs:", error);
          }
        };

        tabs.forEach((btn, idx) => {
          btn.addEventListener("click", () => activateTab(btn));
          btn.addEventListener("keydown", (e) => {
            if (e.key === "ArrowRight" || e.key === "ArrowLeft") {
              e.preventDefault();
              const dir = e.key === "ArrowRight" ? 1 : -1;
              const next = (idx + dir + tabs.length) % tabs.length;
              tabs[next].focus();
              activateTab(tabs[next]);
            }
          });
        });

        // Canvas tabs (Component / Docs / Embed code) + configurator gear
        (function () {
          const btnComp = document.getElementById("ctab-component");
          const btnDocs = document.getElementById("ctab-docs");
          const btnEmbed = document.getElementById("ctab-embed");
          const gearBtn = document.getElementById("gear-config");
          const panelComp = document.getElementById("canvas-component");
          const panelDocs = document.getElementById("canvas-docs");
          const panelEmbed = document.getElementById("canvas-embed");
          const copyBtn = document.getElementById("copy-embed");

          const setActive = (tab) => {
            const isComponent = tab === "component";
            const isDocs = tab === "docs";
            const isEmbed = tab === "embed";

            btnComp?.classList.toggle("active", isComponent);
            btnDocs?.classList.toggle("active", isDocs);
            btnEmbed?.classList.toggle("active", isEmbed);

            btnComp?.setAttribute("aria-selected", String(isComponent));
            btnDocs?.setAttribute("aria-selected", String(isDocs));
            btnEmbed?.setAttribute("aria-selected", String(isEmbed));

            panelComp?.classList.toggle("hidden", !isComponent);
            panelComp?.setAttribute("aria-hidden", String(!isComponent));
            panelDocs?.classList.toggle("hidden", !isDocs);
            panelDocs?.setAttribute("aria-hidden", String(!isDocs));
            panelEmbed?.classList.toggle("hidden", !isEmbed);
            panelEmbed?.setAttribute("aria-hidden", String(!isEmbed));

            if (isEmbed) updateEmbedCode();
          };

          btnComp?.addEventListener("click", () => setActive("component"));
          btnDocs?.addEventListener("click", () => setActive("docs"));
          btnEmbed?.addEventListener("click", () => setActive("embed"));

          gearBtn?.addEventListener("click", () => {
            try {
              panel?.classList.toggle("hidden");
            } catch (e) {}
          });

          if (copyBtn) {
            copyBtn.addEventListener("click", async () => {
              try {
                const codeEl = document.getElementById("embed-code");
                if (!codeEl) return;
                await navigator.clipboard.writeText(codeEl.textContent || "");
                const prev = copyBtn.textContent;
                copyBtn.textContent = "Copied";
                setTimeout(() => (copyBtn.textContent = prev || "Copy"), 1200);
              } catch (e) {
                console.error("Copy failed", e);
              }
            });
          }
        })();

        if (elToggleFloat) {
          elToggleFloat.addEventListener("click", () => {
            try {
              window.KorinAI?.toggleFloatingChat?.();
            } catch (error) {
              console.error("Error toggling floating chat:", error);
            }
          });
        }

        // Live change handlers with debouncing
        let reloadTimeout;
        const debouncedReload = () => {
          clearTimeout(reloadTimeout);
          reloadTimeout = setTimeout(() => {
            reloadActive();
            try {
              updateEmbedCode();
            } catch (e) {}
          }, 300);
        };

        document.querySelectorAll("#config input, #config select").forEach((el) => {
          el.addEventListener("input", debouncedReload);
          el.addEventListener("change", debouncedReload);
        });

        // Initial setup
        try {
          // Set initial theme button text
          if (elToggleTheme) {
            elToggleTheme.textContent = document.body.classList.contains("dark") ? "☀️" : "🌙";
          }

          // Initial mount (Page Chat by default) and set button label
          setMode("page");
          updateFloatingToggleVisibility();
          updateEmbedCode();
        } catch (error) {
          console.error("Error during initial setup:", error);
        }
      })();
    </script>
  </body>
</html>
